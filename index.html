<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        :root { 
            --bg: #0f0f0f; 
            --toolbar: #1a1a1a;
            --skeleton: #252525; 
            --shimmer: #333333;
            --accent: #3d8aff;
        }

        body { 
            margin: 0; 
            background: var(--bg); 
            font-family: 'Inter', -apple-system, sans-serif; 
        }

        /* Fixed Toolbar */
        #toolbar {
            position: fixed;
            top: 0;
            width: 100%;
            height: 60px;
            background: var(--toolbar);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
            z-index: 100;
            border-bottom: 1px solid #333;
            backdrop-filter: blur(10px);
        }

        .title { color: #eee; font-size: 14px; font-weight: 500; }

        .download-btn {
            background: var(--accent);
            color: white;
            text-decoration: none;
            padding: 8px 18px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            transition: transform 0.1s, background 0.2s;
        }

        .download-btn:hover { background: #2979ff; transform: translateY(-1px); }
        .download-btn:active { transform: translateY(0); }

        /* Viewer Layout */
        #viewer-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 90px 10px 40px 10px; /* Space for toolbar */
            gap: 20px;
        }

        .page-wrapper {
            position: relative;
            width: 100%;
            max-width: 850px;
            background: var(--skeleton);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            border-radius: 4px;
            overflow: hidden;
        }

        /* Shimmering Skeleton */
        .skeleton {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(90deg, var(--skeleton) 25%, var(--shimmer) 50%, var(--skeleton) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite linear;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        canvas {
            display: block;
            width: 100%;
            height: auto;
            opacity: 0;
            transition: opacity 0.6s ease;
            position: relative;
            z-index: 2;
        }

        canvas.loaded { opacity: 1; }
    </style>
</head>
<body>

<div id="toolbar">
    <div class="title">pdf.pdf</div>
    <a href="pdf.pdf" download="pdf.pdf" class="download-btn">Download PDF</a>
</div>

<div id="viewer-container"></div>

<script>
    const url = 'pdf.pdf';
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    async function init() {
        const container = document.getElementById('viewer-container');
        
        try {
            const pdf = await pdfjsLib.getDocument(url).promise;
            
            // Determine aspect ratio from first page
            const firstPage = await pdf.getPage(1);
            const viewport = firstPage.getViewport({ scale: 1 });
            const ratio = (viewport.height / viewport.width) * 100;

            for (let i = 1; i <= pdf.numPages; i++) {
                const wrapper = document.createElement('div');
                wrapper.className = 'page-wrapper';
                wrapper.style.paddingBottom = `${ratio}%`; 

                const skeleton = document.createElement('div');
                skeleton.className = 'skeleton';
                
                const canvas = document.createElement('canvas');
                
                wrapper.appendChild(skeleton);
                wrapper.appendChild(canvas);
                container.appendChild(wrapper);

                // Load page when visible
                const observer = new IntersectionObserver((entries) => {
                    if (entries[0].isIntersecting) {
                        renderPage(pdf, i, canvas, skeleton);
                        observer.unobserve(wrapper);
                    }
                }, { rootMargin: '500px' });

                observer.observe(wrapper);
            }
        } catch (err) {
            container.innerHTML = `<div style="color:red; padding: 50px;">Failed to load pdf.pdf. Ensure you are running a local server.</div>`;
        }
    }

    async function renderPage(pdf, num, canvas, skeleton) {
        const page = await pdf.getPage(num);
        const viewport = page.getViewport({ scale: 2 }); // Scale 2 for high quality
        const ctx = canvas.getContext('2d');

        canvas.height = viewport.height;
        canvas.width = viewport.width;

        await page.render({ canvasContext: ctx, viewport }).promise;
        
        canvas.classList.add('loaded');
        setTimeout(() => skeleton.remove(), 600);
    }

    init();
</script>

</body>
</html>