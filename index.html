<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        :root { --bg: #1a1a1a; --card: #2d2d2d; --accent: #3498db; }
        body { margin: 0; background: var(--bg); font-family: system-ui, -apple-system, sans-serif; }
        
        #viewer-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            gap: 30px;
        }

        /* Modern Skeleton Loader */
        .page-wrapper {
            position: relative;
            background: var(--card);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            min-width: 800px; /* Standard A4 ratio */
            min-height: 1100px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
        }

        .skeleton {
            width: 100%;
            height: 100%;
            background: linear-gradient(110deg, #2d2d2d 8%, #3d3d3d 18%, #2d2d2d 33%);
            background-size: 200% 100%;
            animation: shine 1.5s linear infinite;
        }

        @keyframes shine {
            to { background-position-x: -200%; }
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: block;
            opacity: 0;
            transition: opacity 0.5s ease-in;
        }

        canvas.loaded { opacity: 1; }
    </style>
</head>
<body>

<div id="viewer-container"></div>

<script>
    const url = 'pdf.pdf';
    const container = document.getElementById('viewer-container');
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    async function init() {
        const pdf = await pdfjsLib.getDocument(url).promise;
        
        for (let i = 1; i <= pdf.numPages; i++) {
            // 1. Create Wrapper and Skeleton
            const wrapper = document.createElement('div');
            wrapper.className = 'page-wrapper';
            
            const skeleton = document.createElement('div');
            skeleton.className = 'skeleton';
            wrapper.appendChild(skeleton);
            
            const canvas = document.createElement('canvas');
            wrapper.appendChild(canvas);
            container.appendChild(wrapper);

            // 2. Setup Intersection Observer (Load when visible)
            const observer = new IntersectionObserver((entries) => {
                if (entries[0].isIntersecting) {
                    renderPage(pdf, i, canvas, skeleton);
                    observer.unobserve(wrapper); // Only render once
                }
            }, { rootMargin: '200px' });

            observer.observe(wrapper);
        }
    }

    async function renderPage(pdf, num, canvas, skeleton) {
        const page = await pdf.getPage(num);
        const viewport = page.getViewport({ scale: 2 }); // High DPI scale
        const ctx = canvas.getContext('2d');

        canvas.height = viewport.height;
        canvas.width = viewport.width;

        await page.render({ canvasContext: ctx, viewport }).promise;
        
        canvas.classList.add('loaded');
        setTimeout(() => skeleton.remove(), 500); // Clean up skeleton
    }

    init().catch(console.error);
</script>

</body>
</html>